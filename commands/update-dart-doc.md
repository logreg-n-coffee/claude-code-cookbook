# Update Dart Doc

Systematically manage DartDoc comments in Dart files and maintain high-quality Japanese documentation.

## Usage

```bash
# Execute both new additions and updates simultaneously
"Add DartDoc comments to classes without them and update comments that don't meet standards"

# Check changed files in PR
"Check if changed files in PR #4308 have Claude markers in their DartDoc"

# Document organization for specific directory
"Add DartDoc to Widget classes under packages/app/lib/ui/screen/"

# Execute without markers
/update-dart-doc --marker false
"Improve DartDoc for existing project (don't add Claude markers)"
```

### Options

- `--marker <true|false>` : Whether to add Claude markers (default: true)

### Basic Examples

```bash
# 1. Analyze target files
find . -name "*.dart" -not -path "*/.*" | grep -v "_test.dart" | grep -v "_vrt.dart"
"Identify classes lacking DartDoc (0 comment lines or less than 30 characters)"

# 2. Add documentation
"Add DartDoc comments containing required elements to identified classes"

# 3. Verify markers
"Confirm that all added/updated DartDoc have Claude markers"
```

### Execution Procedure

#### Target Element Priority

1. üî¥ **Highest Priority**: Elements without DartDoc comments (0 comment lines)
2. üü° **Next Priority**: Elements not meeting standards (less than 30 characters or missing required elements)
3. üü¢ **Verification Target**: Existing comments without Claude markers

**Target Elements**:

- Class (all class definitions)
- Enum (enumeration types)
- Extension (extension methods)  
- Important functions (top-level functions, optional)

#### DartDoc Writing Rules

**Basic Structure**:

```dart
/// {Element overview description} (30-60 characters, required)
///
/// {Detailed description} (must include role, usage context, and notes, 50-200 characters)
///
/// Generated by Claude ü§ñ
@Annotation  // Don't change existing annotations
class ClassName {
```

**Writing Style**:

- Polite form (desu/masu): "displays", "class that manages"
- Use Japanese punctuation: "„ÄÇ" "„ÄÅ"
- Half-width space between Japanese and alphanumeric characters
- Technical terms in English: "Authentication state"
- Each line within 80 characters

#### Writing Examples by Class Category

**State Management Class (Riverpod)**:

```dart
/// State that manages horizontal swipe gesture disabling.
///
/// Used when horizontal swipe needs to be disabled on specific
/// screens or during operations. For example, during carousel display or specific input.
///
/// Generated by Claude ü§ñ
@Riverpod(keepAlive: true, dependencies: [])
class HorizontalDragGestureIgnoreState extends _$HorizontalDragGestureIgnoreState {
```

**Widget Class**:

```dart
/// Widget that displays user profile.
///
/// Arranges avatar image, username, and status information vertically,
/// navigates to profile detail screen when tapped.
///
/// Generated by Claude ü§ñ
class UserProfileWidget extends HookConsumerWidget {
```

#### Existing Content Preservation Rules

1. **When existing comments meet standards**: Preserve as is (don't add new)
   - Standards: 30+ characters and includes required elements (overview, details, marker)
2. **When existing comments don't meet standards**: Complete replacement (no duplication)
3. **When no existing comments**: Add new comments

**Important Information to Preserve**:

- URLs and links: References starting with `See also:`
- TODO comments: `TODO(user_name):` format
- Notes: Warnings starting with `Note:` or `Warning:`
- Usage examples: Code starting with `Example:`
- Technical constraints: Performance and limitation descriptions

### Claude Marker Management

```bash
# Marker format
/// Generated by Claude ü§ñ

# Check markers in PR changed files
gh pr diff 4308 --name-only | grep "\.dart$" | xargs grep -l "Generated by Claude"
"Add to files without markers"
```

### Quality Checklist

- ‚úÖ **Character count**: Strictly follow 30-60 characters for overview, 50-200 for details
- ‚úÖ **Required elements**: Must include overview, detailed description, and Claude marker
- ‚úÖ **Completeness**: Include role, usage context, and notes
- ‚úÖ **Consistency**: Unify writing style with polite form (desu/masu)
- ‚úÖ **Format**: Half-width space between Japanese and English
- ‚úÖ **Accuracy**: Analyze implementation, describe only facts
- ‚úÖ **Structure**: Preserve annotations, place comments above
- ‚úÖ **Length**: Each line within 80 characters
- ‚úÖ **Marker**: Always add marker for Claude changes

### Important Notes

**üî¥ Absolutely Prohibited**:

- ‚ùå Code changes other than documentation comments
- ‚ùå Speculation about implementation details (facts only)
- ‚ùå Unnatural mixing of English and Japanese
- ‚ùå Deleting or changing existing annotations
- ‚ùå Duplication with existing comments
- ‚ùå Comments below character standards in test files (`*_test.dart`)
- ‚ùå Comments below character standards in VRT files (`*_vrt.dart`)

**Static Analysis and Commit**:

```bash
# Record execution results
ADDED_COMMENTS=0
UPDATED_COMMENTS=0
ERRORS=0

# Verify after changes
melos analyze
if [ $? -ne 0 ]; then
  echo "üî¥ Error: Static analysis failed"
  exit 1
fi

# Output execution summary
echo "üìä Execution Results:"
echo "- Added comments: $ADDED_COMMENTS items"
echo "- Updated comments: $UPDATED_COMMENTS items" 
echo "- Error count: $ERRORS items"

# Commit example
git commit -m "docs: Add and update DartDoc comments

- Add DartDoc to classes, enums, extensions not meeting standards
- Update comments under 30 characters to meet standards
- Uniformly add Claude markers

Execution results:
- Added: $ADDED_COMMENTS items
- Updated: $UPDATED_COMMENTS items

Generated by Claude ü§ñ"
```

### Execution Success Criteria

1. **Completion Criteria**: Success when all of the following are met:
   - `melos analyze` PASSED
   - Error count is 0
   - All added/updated comments meet standards

2. **Partial Success**: When:
   - Error count is less than 5
   - 90% or more meet standards

3. **Failure**: When:
   - `melos analyze` FAILED
   - Error count is 5 or more

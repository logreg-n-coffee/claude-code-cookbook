## Update Doc String

Systematically manage multilingual docstrings/comments and maintain high-quality documentation.

### Usage

```bash
# Execute with automatic language detection
"Add docstrings to classes/functions without them and update comments that don't meet standards"

# Execute with specified language
/update-doc-string --lang python
"Update Python file docstrings in PEP 257 compliance"

# Document organization for specific directory
"Add JSDoc to functions under src/components/"
```

### Options

- `--lang <en|ja>` : Documentation language (default: auto-detect from existing comments, en if none)
- `--style <style>` : Specify documentation style (language-specific defaults available)
- `--marker <true|false>` : Whether to add Claude markers (default: true)

### Basic Examples

```bash
# 1. Analyze target files (programming language auto-detected)
find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" -o -name "*.dart" -o -name "*.go" -o -name "*.rs" \) | grep -v test
"Identify elements lacking docstrings (0 comment lines or less than 30 characters)"

# 2. Add documentation (automatic language detection)
"Add docstrings containing language-specific required elements to identified elements"
# → Write in Japanese if existing comments contain Japanese, otherwise in English

# 3. Add documentation (explicitly specify English)
/update-doc-string --lang en
"Add docstrings with required elements to the identified elements"

# 4. Verify markers
"Confirm that all added/updated docstrings have Claude markers"
```

### Execution Procedure

#### Target Element Priority

1. 🔴 **Highest Priority**: Elements without docstrings/comments (0 comment lines)
2. 🟡 **Next Priority**: Elements not meeting standards (less than 30 characters or missing required elements)
3. 🟢 **Verification Target**: Existing comments without Claude markers

**Target Elements (Common to all languages)**:

- Class/Class definitions
- Function/Functions & methods
- Module/Modules (Python, Go)
- Enum/Enumerations
- Interface/Interfaces (TypeScript, Go)

#### 2. Language-Specific Writing Rules

**Python (PEP 257)**:

```python
# Japanese version (default)
def calculate_total(items: List[Item]) -> float:
    """Calculate the total amount for an item list. (30-60 chars)

    Multiplies price and quantity of each item and returns
    total with tax. Returns 0.0 for empty lists. (50-200 chars)

    Args:
        items: List of items to calculate

    Returns:
        Total amount with tax

    Generated by Claude 🤖
    """

# English version (--lang en)
def calculate_total(items: List[Item]) -> float:
    """Calculate the total amount for a list of items. (30-60 chars)

    Multiplies the price and quantity of each item and returns
    the total with tax. Returns 0.0 for empty lists. (50-200 chars)

    Args:
        items: List of items to calculate

    Returns:
        Total amount with tax

    Generated by Claude 🤖
    """
```

**JavaScript/TypeScript (JSDoc)**:

```javascript
/**
 * Component that displays user profile. (30-60 chars)
 *
 * Displays avatar image, username, and status information,
 * and navigates to profile detail screen on click. (50-200 chars)
 *
 * @param {Object} props - Component properties
 * @param {string} props.userId - User ID
 * @param {boolean} [props.showStatus=true] - Status display flag
 * @returns {JSX.Element} Rendered component
 *
 * @generated by Claude 🤖
 */
const UserProfile = ({ userId, showStatus = true }) => {
```

**Go**:

```go
// CalculateTotal calculates the total amount for an item list. (30-60 chars)
//
// Multiplies price and quantity of each item and returns
// total with tax. Returns 0.0 for empty slices. (50-200 chars)
//
// Generated by Claude 🤖
func CalculateTotal(items []Item) float64 {
```

**Rust**:

```rust
/// Calculate the total amount for an item list. (30-60 chars)
///
/// Multiplies price and quantity of each item and returns
/// total with tax. Returns 0.0 for empty vectors. (50-200 chars)
///
/// Generated by Claude 🤖
pub fn calculate_total(items: &[Item]) -> f64 {
```

**Dart (DartDoc)**:

```dart
/// Widget that displays user profile. (30-60 chars)
///
/// Arranges avatar image, username, and status information vertically,
/// and navigates to profile detail screen on tap. (50-200 chars)
///
/// Generated by Claude 🤖
class UserProfileWidget extends StatelessWidget {
```

#### 3. Existing Content Preservation Rules

1. **When existing comments meet standards**: Keep as-is (don't add new ones)
   - Standards: 30+ characters and includes required elements (summary, detail, marker)
2. **When existing comments don't meet standards**: Complete replacement (avoid duplication)
3. **When no existing comments**: Add new comments

**Important Information to Preserve**:

- URLs and links: `See also:`, `@see`, `Reference:` etc.
- TODO comments: `TODO:`, `FIXME:`, `XXX:` format
- Warnings: `Note:`, `Warning:`, `Caution:` etc.
- Usage examples: `Example:`, `Examples:`, `# Examples` etc.
- Existing parameter and return value descriptions

### Language-Specific Settings

```yaml
# Language-specific default settings
languages:
  python:
    style: "google"  # google, numpy, sphinx
    indent: 4
    quotes: '"""'

  javascript:
    style: "jsdoc"
    indent: 2
    prefix: "/**"
    suffix: "*/"

  typescript:
    style: "tsdoc"
    indent: 2
    prefix: "/**"
    suffix: "*/"

  go:
    style: "godoc"
    indent: 0
    prefix: "//"

  rust:
    style: "rustdoc"
    indent: 0
    prefix: "///"

  dart:
    style: "dartdoc"
    indent: 0
    prefix: "///"
```

### Quality Checklist

- ✅ **Character count**: Strictly follow 30-60 characters for summary, 50-200 characters for details
- ✅ **Required elements**: Must include 3 elements: summary, detailed description, Claude marker
- ✅ **Completeness**: Document role, usage context, and precautions
- ✅ **Language conventions**: Comply with official style guides for each language
- ✅ **Exceptions**: Error/exception descriptions (when applicable)
- ✅ **Accuracy**: Analyze implementation and document only facts

### Important Notes

**🔴 Absolute Prohibitions**:

- ❌ Code changes other than documentation comments
- ❌ Speculation about implementation details (document facts only)
- ❌ Formats that violate language conventions
- ❌ Deletion/modification of existing type annotations
- ❌ Duplication with existing comments
- ❌ Comments below character count standards in test files

**Execution and Verification**:

```bash
# Record execution results
ADDED_COMMENTS=0
UPDATED_COMMENTS=0
ERRORS=0

# Auto-detect language from existing comments
# If Japanese characters (hiragana, katakana, kanji) detected, use ja; otherwise en
DOC_LANGUAGE="en"  # Default
if grep -r '[ぁ-んァ-ヶー一-龠]' --include="*.py" --include="*.js" --include="*.ts" --include="*.dart" --include="*.go" --include="*.rs" . 2>/dev/null | head -n 1; then
  DOC_LANGUAGE="ja"
fi

# Auto-detect programming language and perform static analysis
if [ -f "*.py" ]; then
  pylint --disable=all --enable=missing-docstring .
elif [ -f "*.js" ] || [ -f "*.ts" ]; then
  eslint . --rule 'jsdoc/require-jsdoc: error'
elif [ -f "*.go" ]; then
  golint ./...
elif [ -f "*.rs" ]; then
  cargo doc --no-deps
elif [ -f "*.dart" ]; then
  melos analyze
fi

if [ $? -ne 0 ]; then
  echo "🔴 Error: Static analysis failed"
  exit 1
fi

# Output execution summary
echo "📊 Execution Results:"
echo "- Documentation language: $DOC_LANGUAGE"
echo "- Comments added: $ADDED_COMMENTS items"
echo "- Comments updated: $UPDATED_COMMENTS items"
echo "- Errors occurred: $ERRORS items"
```

### Success Criteria

1. **Completion criteria**: Success when all of the following are met
   - Language-specific static analysis PASSED
   - Error count is 0
   - All added/updated comments meet standards

2. **Partial success**: When the following occurs
   - Error count is less than 5
   - 90% or more meet standards

3. **Failure**: When the following occurs
   - Static analysis FAILED
   - Error count is 5 or more

### Integration with Claude

```bash
# Project-wide analysis (automatic language detection)
find . -type f \( -name "*.py" -o -name "*.js" -o -name "*.ts" \)
/update-doc-string
"Update docstrings for this project following language-specific best practices"
# → Execute in ja if existing comments contain Japanese, otherwise in en

# Explicitly execute with English documentation
/update-doc-string --lang en
"Update docstrings following language-specific best practices"

# Explicitly execute with Japanese documentation
/update-doc-string --lang ja
"Update docstrings for this project following language-specific best practices"

# Execute without markers (automatic language detection)
/update-doc-string --marker false
"Improve existing docstrings without adding Claude markers"

# English documentation, no markers
/update-doc-string --lang en --marker false
"Improve existing docstrings without adding Claude markers"
```
